<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RH Freeman — Project Plan</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Josefin+Sans:wght@300;400;500&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Josefin Sans', sans-serif; background: #F7F3EC; color: #1E1D1A; padding: 40px 20px 80px; }

  .container { max-width: 960px; margin: 0 auto; }

  /* Header */
  .plan-header { text-align: center; margin-bottom: 48px; padding-top: 20px; }
  .plan-header h1 { font-family: 'Cormorant Garamond', serif; font-size: 32px; font-weight: 400; color: #181D38; margin-bottom: 8px; }
  .plan-header .subtitle { font-size: 13px; color: #8A857C; letter-spacing: 0.05em; margin-bottom: 16px; }
  .plan-header .meta { font-size: 11px; color: #8A857C; }
  .plan-header .back-link { display: inline-block; margin-bottom: 24px; font-size: 11px; letter-spacing: 0.15em; text-transform: uppercase; color: #B89A5A; text-decoration: none; }
  .plan-header .back-link:hover { color: #181D38; }

  /* Legend */
  .legend { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-bottom: 40px; padding: 16px; background: white; border: 1px solid rgba(184,154,90,0.15); }
  .legend-item { font-size: 11px; color: #8A857C; display: flex; align-items: center; gap: 6px; }
  .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
  .legend-dot.done { background: #4CAF50; }
  .legend-dot.progress { background: #FF9800; }
  .legend-dot.pending { background: #BDBDBD; }
  .legend-dot.blocked { background: #F44336; }
  .legend-dot.future { background: #90CAF9; }

  /* Phase */
  .phase { margin-bottom: 40px; }
  .phase-title { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 600; color: #181D38; margin-bottom: 4px; }
  .phase-warning { font-size: 12px; color: #CC6600; font-style: italic; margin-bottom: 12px; line-height: 1.5; }

  /* Table */
  .plan-table { width: 100%; border-collapse: collapse; background: white; border: 1px solid rgba(184,154,90,0.15); margin-bottom: 8px; }
  .plan-table th { background: #181D38; color: #F5F0E8; font-size: 11px; letter-spacing: 0.1em; text-transform: uppercase; padding: 10px 14px; text-align: left; font-weight: 500; }
  .plan-table th:nth-child(2), .plan-table th:nth-child(3) { text-align: center; }
  .plan-table td { padding: 10px 14px; font-size: 13px; border-bottom: 1px solid rgba(184,154,90,0.08); vertical-align: top; }
  .plan-table tr:nth-child(even) { background: #FDFAF3; }
  .plan-table td:nth-child(2), .plan-table td:nth-child(3) { text-align: center; color: #8A857C; font-size: 12px; }
  .plan-table td:nth-child(4) { font-size: 11px; color: #8A857C; font-style: italic; cursor: pointer; min-width: 120px; position: relative; }
  .plan-table td:nth-child(4):hover { background: rgba(184,154,90,0.06); }
  .plan-table td:nth-child(4)::after { content: ''; }
  .plan-table td[data-notes-for]:empty::after { content: 'click to add note'; color: #C8C3BA; font-style: italic; }
  .note-input { width: 100%; border: 1px solid #B89A5A; background: #FFFDF7; padding: 4px 8px; font-family: 'Josefin Sans', sans-serif; font-size: 11px; color: #4A4640; outline: none; border-radius: 3px; }

  /* Status badges */
  .status { display: inline-block; padding: 2px 10px; border-radius: 10px; font-size: 10px; letter-spacing: 0.05em; font-weight: 500; }
  .status.done { background: rgba(76,175,80,0.1); color: #4CAF50; }
  .status.progress { background: rgba(255,152,0,0.1); color: #FF9800; }
  .status.pending { background: rgba(189,189,189,0.15); color: #9E9E9E; }
  .status.blocked { background: rgba(244,67,54,0.1); color: #F44336; }
  .status.future { background: rgba(144,202,249,0.2); color: #42A5F5; }
  .status { cursor: pointer; transition: transform 0.15s, box-shadow 0.15s; user-select: none; position: relative; }
  .status:hover { transform: scale(1.1); box-shadow: 0 1px 4px rgba(0,0,0,0.12); }
  .status:active { transform: scale(0.95); }
  .status-select { font-family: 'Josefin Sans', sans-serif; font-size: 10px; font-weight: 500; padding: 2px 6px; border: 1px solid #B89A5A; border-radius: 10px; background: #FFFDF7; color: #4A4640; outline: none; cursor: pointer; appearance: auto; }
  .sync-bar { text-align: center; font-size: 11px; color: #8A857C; margin-bottom: 24px; padding: 8px; background: white; border: 1px solid rgba(184,154,90,0.15); }
  .sync-bar .dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 6px; vertical-align: middle; }
  .sync-bar .dot.ok { background: #4CAF50; }
  .sync-bar .dot.saving { background: #FF9800; }
  .sync-bar .dot.err { background: #F44336; }

  /* Recommendation section */
  .recommendation { background: white; border: 1px solid rgba(184,154,90,0.2); padding: 32px; margin-top: 48px; }
  .recommendation h2 { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 600; color: #181D38; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #C4A265; }
  .recommendation h3 { font-size: 14px; font-weight: 500; color: #181D38; margin: 16px 0 8px; }
  .recommendation p { font-size: 13px; color: #4A4640; line-height: 1.7; margin-bottom: 8px; }
  .recommendation ul { list-style: none; padding: 0; }
  .recommendation li { font-size: 13px; color: #4A4640; line-height: 1.7; padding: 4px 0 4px 20px; position: relative; }
  .recommendation li::before { content: '•'; position: absolute; left: 0; color: #B89A5A; }
  .recommendation .note { margin-top: 16px; padding-top: 12px; border-top: 1px solid rgba(184,154,90,0.1); font-size: 12px; color: #8A857C; font-style: italic; }

  /* Footer */
  .plan-footer { text-align: center; margin-top: 48px; padding-top: 24px; border-top: 1px solid rgba(184,154,90,0.15); }
  .plan-footer p { font-size: 11px; color: #8A857C; line-height: 1.8; }
  .plan-footer a { color: #ff6b2b; text-decoration: none; }

  @media (max-width: 640px) {
    .plan-table { font-size: 12px; }
    .plan-table th, .plan-table td { padding: 8px 10px; }
    .legend { flex-direction: column; align-items: center; }
  }
</style>
</head>
<body>
<div class="container">

  <div class="plan-header">
    <a href="index.html" class="back-link">← Back to Portal</a>
    <h1>Website Go-Live Checklist</h1>
    <p class="subtitle">Six-phase project plan for the RH Freeman website rebuild</p>
    <p class="meta">Prepared by Data Tradies · Updated February 2026 · Version 2.0</p>
  </div>

  <div class="legend">
    <span class="legend-item"><span class="legend-dot done"></span> Done</span>
    <span class="legend-item"><span class="legend-dot progress"></span> In Progress</span>
    <span class="legend-item"><span class="legend-dot pending"></span> Pending</span>
    <span class="legend-item"><span class="legend-dot blocked"></span> Blocked</span>
    <span class="legend-item"><span class="legend-dot future"></span> Future</span>
  </div>

  <div class="sync-bar" id="syncBar"><span class="dot ok" id="syncDot"></span> <span id="syncText">Click any status badge to update it</span></div>

  <!-- PHASE 1 -->
  <div class="phase">
    <h2 class="phase-title">Phase 1 — Design Sign-Off</h2>
    <table class="plan-table">
      <thead><tr><th>Task</th><th>Owner</th><th>Status</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Review dark and light theme proposals</td><td>RHF</td><td><span class="status progress" data-task-id="p1-review-themes">In Progress</span></td><td data-notes-for="p1-review-themes">Live on Vercel</td></tr>
        <tr><td>Choose preferred theme (dark/light)</td><td>RHF</td><td><span class="status pending" data-task-id="p1-choose-theme">Pending</span></td><td data-notes-for="p1-choose-theme"></td></tr>
        <tr><td>Confirm page structure and sections</td><td>RHF</td><td><span class="status pending" data-task-id="p1-confirm-structure">Pending</span></td><td data-notes-for="p1-confirm-structure"></td></tr>
        <tr><td>Approve logo placement and sizing</td><td>RHF</td><td><span class="status done" data-task-id="p1-approve-logo">Done</span></td><td data-notes-for="p1-approve-logo">Logo 1 &amp; 2 approved</td></tr>
        <tr><td>Confirm colour palette and typography</td><td>RHF</td><td><span class="status done" data-task-id="p1-confirm-colours">Done</span></td><td data-notes-for="p1-confirm-colours">Navy/gold/cream</td></tr>
      </tbody>
    </table>
  </div>

  <!-- PHASE 2 -->
  <div class="phase">
    <h2 class="phase-title">Phase 2 — Content from Client</h2>
    <p class="phase-warning">⚠ Critical path — photography and client approvals are the main blockers. Phone photos sufficient for Phase 1.</p>
    <table class="plan-table">
      <thead><tr><th>Task</th><th>Owner</th><th>Status</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Workshop / factory floor photos (5–10)</td><td>RHF</td><td><span class="status pending" data-task-id="p2-workshop-photos">Pending</span></td><td data-notes-for="p2-workshop-photos">Phone photos OK</td></tr>
        <tr><td>Product / sample photos (5–10)</td><td>RHF</td><td><span class="status pending" data-task-id="p2-product-photos">Pending</span></td><td data-notes-for="p2-product-photos"></td></tr>
        <tr><td>Team headshots (Gerhard, Chantelle, Sam, Ro)</td><td>RHF</td><td><span class="status pending" data-task-id="p2-team-headshots">Pending</span></td><td data-notes-for="p2-team-headshots"></td></tr>
        <tr><td>Building exterior photo</td><td>RHF</td><td><span class="status pending" data-task-id="p2-building-photo">Pending</span></td><td data-notes-for="p2-building-photo"></td></tr>
        <tr><td>Client logos (3–5 with permission)</td><td>RHF</td><td><span class="status pending" data-task-id="p2-client-logos">Pending</span></td><td data-notes-for="p2-client-logos">Gallagher, Designbrand, RPS?</td></tr>
        <tr><td>Confirm testimonials are still current</td><td>RHF</td><td><span class="status pending" data-task-id="p2-confirm-testimonials">Pending</span></td><td data-notes-for="p2-confirm-testimonials">3 from old site used</td></tr>
        <tr><td>Confirm case studies are still current</td><td>RHF</td><td><span class="status pending" data-task-id="p2-confirm-case-studies">Pending</span></td><td data-notes-for="p2-confirm-case-studies">Supreme Court, Archives NZ</td></tr>
        <tr><td>Team bios and titles for website</td><td>RHF</td><td><span class="status pending" data-task-id="p2-team-bios">Pending</span></td><td data-notes-for="p2-team-bios">Current placeholders OK?</td></tr>
        <tr><td>Company story / about text review</td><td>RHF</td><td><span class="status pending" data-task-id="p2-about-text">Pending</span></td><td data-notes-for="p2-about-text"></td></tr>
        <tr><td>Contact details: phone, address, email</td><td>Both</td><td><span class="status progress" data-task-id="p2-contact-details">In Progress</span></td><td data-notes-for="p2-contact-details">(04) 232 6009 confirmed</td></tr>
        <tr><td>Legal entity name for footer</td><td>RHF</td><td><span class="status pending" data-task-id="p2-legal-entity">Pending</span></td><td data-notes-for="p2-legal-entity">R H Freeman &amp; Co Ltd?</td></tr>
      </tbody>
    </table>
  </div>

  <!-- PHASE 3 -->
  <div class="phase">
    <h2 class="phase-title">Phase 3 — Domain, Hosting &amp; Email</h2>
    <p class="phase-warning">⚠ Neos manages DNS — coordinate carefully to avoid breaking email (MX, SPF, DKIM, DMARC records).</p>
    <table class="plan-table">
      <thead><tr><th>Task</th><th>Owner</th><th>Status</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Confirm primary domain (rhfreeman.co.nz?)</td><td>RHF</td><td><span class="status pending" data-task-id="p3-confirm-domain">Pending</span></td><td data-notes-for="p3-confirm-domain"></td></tr>
        <tr><td>Register or transfer domain</td><td>Marnus</td><td><span class="status pending" data-task-id="p3-register-domain">Pending</span></td><td data-notes-for="p3-register-domain"></td></tr>
        <tr><td>Coordinate DNS changes with Neos</td><td>Marnus</td><td><span class="status pending" data-task-id="p3-dns-neos">Pending</span></td><td data-notes-for="p3-dns-neos">Critical: protect email</td></tr>
        <tr><td>Connect domain to Vercel hosting</td><td>Marnus</td><td><span class="status pending" data-task-id="p3-connect-vercel">Pending</span></td><td data-notes-for="p3-connect-vercel"></td></tr>
        <tr><td>Configure email DNS records (MX/SPF/DKIM)</td><td>Marnus</td><td><span class="status pending" data-task-id="p3-email-dns">Pending</span></td><td data-notes-for="p3-email-dns">Test after change</td></tr>
        <tr><td>Set up GitHub repository for site code</td><td>Marnus</td><td><span class="status done" data-task-id="p3-github-repo">Done</span></td><td data-notes-for="p3-github-repo"></td></tr>
        <tr><td>Set up info@rhfreeman.co.nz shared mailbox or alias</td><td>Both</td><td><span class="status pending" data-task-id="p3-info-mailbox">Pending</span></td><td data-notes-for="p3-info-mailbox">See recommendation below</td></tr>
        <tr><td>Set up sales@rhfreeman.co.nz shared mailbox or alias</td><td>Both</td><td><span class="status pending" data-task-id="p3-sales-mailbox">Pending</span></td><td data-notes-for="p3-sales-mailbox">For website enquiries</td></tr>
        <tr><td>Review email domain strategy (freemans.co.nz vs rhfreeman.co.nz)</td><td>Both</td><td><span class="status pending" data-task-id="p3-email-strategy">Pending</span></td><td data-notes-for="p3-email-strategy">See recommendation below</td></tr>
      </tbody>
    </table>
  </div>

  <!-- PHASE 4 -->
  <div class="phase">
    <h2 class="phase-title">Phase 4 — Build &amp; Integration</h2>
    <table class="plan-table">
      <thead><tr><th>Task</th><th>Owner</th><th>Status</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Integrate real photography into pages</td><td>Marnus</td><td><span class="status blocked" data-task-id="p4-real-photography">Blocked</span></td><td data-notes-for="p4-real-photography">Waiting Phase 2</td></tr>
        <tr><td>Replace all placeholder content</td><td>Marnus</td><td><span class="status progress" data-task-id="p4-replace-placeholder">In Progress</span></td><td data-notes-for="p4-replace-placeholder">Services, cases, testimonials done</td></tr>
        <tr><td>Add client logos to Trusted By section</td><td>Marnus</td><td><span class="status blocked" data-task-id="p4-client-logos-section">Blocked</span></td><td data-notes-for="p4-client-logos-section">Need logos + permission</td></tr>
        <tr><td>Insert team photos</td><td>Marnus</td><td><span class="status blocked" data-task-id="p4-team-photos">Blocked</span></td><td data-notes-for="p4-team-photos">Waiting Phase 2</td></tr>
        <tr><td>Build contact page / form</td><td>Marnus</td><td><span class="status pending" data-task-id="p4-contact-form">Pending</span></td><td data-notes-for="p4-contact-form">Links to info@ mailbox</td></tr>
        <tr><td>Build inner pages (About, Services detail)</td><td>Marnus</td><td><span class="status future" data-task-id="p4-inner-pages">Future</span></td><td data-notes-for="p4-inner-pages"></td></tr>
        <tr><td>Create and add favicon</td><td>Marnus</td><td><span class="status pending" data-task-id="p4-favicon">Pending</span></td><td data-notes-for="p4-favicon"></td></tr>
        <tr><td>Add SEO metadata (title, description, OG tags)</td><td>Marnus</td><td><span class="status pending" data-task-id="p4-seo-metadata">Pending</span></td><td data-notes-for="p4-seo-metadata"></td></tr>
        <tr><td>Set up Google Analytics / Tag Manager</td><td>Marnus</td><td><span class="status pending" data-task-id="p4-analytics">Pending</span></td><td data-notes-for="p4-analytics"></td></tr>
        <tr><td>Remove any Tiri Group references from content</td><td>Marnus</td><td><span class="status done" data-task-id="p4-remove-tiri">Done</span></td><td data-notes-for="p4-remove-tiri">Checked both themes</td></tr>
      </tbody>
    </table>
  </div>

  <!-- PHASE 5 -->
  <div class="phase">
    <h2 class="phase-title">Phase 5 — Testing &amp; Launch</h2>
    <table class="plan-table">
      <thead><tr><th>Task</th><th>Owner</th><th>Status</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Cross-browser testing (Chrome, Safari, Edge, Firefox)</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-cross-browser">Pending</span></td><td data-notes-for="p5-cross-browser"></td></tr>
        <tr><td>Mobile responsiveness testing</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-mobile-testing">Pending</span></td><td data-notes-for="p5-mobile-testing"></td></tr>
        <tr><td>Performance / page speed audit</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-performance">Pending</span></td><td data-notes-for="p5-performance"></td></tr>
        <tr><td>Check all links working</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-check-links">Pending</span></td><td data-notes-for="p5-check-links"></td></tr>
        <tr><td>Proofread all content</td><td>Both</td><td><span class="status pending" data-task-id="p5-proofread">Pending</span></td><td data-notes-for="p5-proofread"></td></tr>
        <tr><td>Final client sign-off</td><td>RHF</td><td><span class="status pending" data-task-id="p5-client-signoff">Pending</span></td><td data-notes-for="p5-client-signoff"></td></tr>
        <tr><td>Switch DNS to live site</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-switch-dns">Pending</span></td><td data-notes-for="p5-switch-dns">Coordinate with Neos</td></tr>
        <tr><td>Verify SSL certificate active</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-ssl-cert">Pending</span></td><td data-notes-for="p5-ssl-cert">Auto via Vercel</td></tr>
        <tr><td>Submit sitemap to Google Search Console</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-sitemap">Pending</span></td><td data-notes-for="p5-sitemap"></td></tr>
        <tr><td>Set up redirects from old site if needed</td><td>Marnus</td><td><span class="status pending" data-task-id="p5-redirects">Pending</span></td><td data-notes-for="p5-redirects"></td></tr>
      </tbody>
    </table>
  </div>

  <!-- PHASE 6 -->
  <div class="phase">
    <h2 class="phase-title">Phase 6 — Post-Launch Enhancements</h2>
    <table class="plan-table">
      <thead><tr><th>Task</th><th>Owner</th><th>Status</th><th>Notes</th></tr></thead>
      <tbody>
        <tr><td>Blog / news section</td><td>Both</td><td><span class="status future" data-task-id="p6-blog">Future</span></td><td data-notes-for="p6-blog"></td></tr>
        <tr><td>Detailed capability pages (one per service)</td><td>Marnus</td><td><span class="status future" data-task-id="p6-capability-pages">Future</span></td><td data-notes-for="p6-capability-pages"></td></tr>
        <tr><td>Downloadable company brochure (PDF)</td><td>Both</td><td><span class="status future" data-task-id="p6-brochure">Future</span></td><td data-notes-for="p6-brochure"></td></tr>
        <tr><td>Cookie consent banner</td><td>Marnus</td><td><span class="status future" data-task-id="p6-cookie-consent">Future</span></td><td data-notes-for="p6-cookie-consent">If analytics added</td></tr>
        <tr><td>Privacy policy and terms of service pages</td><td>Both</td><td><span class="status future" data-task-id="p6-privacy-terms">Future</span></td><td data-notes-for="p6-privacy-terms"></td></tr>
      </tbody>
    </table>
  </div>

  <!-- EMAIL RECOMMENDATION -->
  <div class="recommendation">
    <h2>Recommendation: Email &amp; Domain Strategy</h2>

    <h3>Current situation</h3>
    <p>Staff use personal mailboxes on freemans.co.nz (e.g. gerhard@freemans.co.nz, chantelle@freemans.co.nz). The website and company registration use rhfreeman.co.nz. The current live website contact page shows admin@freemans.co.nz. This creates a disconnect between the brand customers see online and the emails they receive.</p>

    <h3>Recommended actions</h3>
    <ul>
      <li>Create shared mailboxes or aliases on the website domain: info@rhfreeman.co.nz (general enquiries, website contact form), sales@rhfreeman.co.nz (quotes and new business).</li>
      <li>Consider standardising staff email addresses to @rhfreeman.co.nz to match the public brand (e.g. gerhard@rhfreeman.co.nz). This can be done as aliases initially so both domains work.</li>
      <li>Keep freemans.co.nz active as a secondary domain but route new customer-facing communications through rhfreeman.co.nz for brand consistency.</li>
      <li>Coordinate with Neos to configure MX, SPF, DKIM, and DMARC records correctly on the website domain before go-live.</li>
      <li>If M365 is the email platform, shared mailboxes are included at no extra cost. Aliases are even simpler.</li>
    </ul>

    <p class="note">This is a quick win that costs nothing (M365 shared mailboxes are free) and immediately makes the brand more professional and consistent.</p>
  </div>

  <!-- FOOTER -->
  <div class="plan-footer">
    <p>
      Prepared by Marnus Bosch — <a href="https://datatradies.co.nz" target="_blank">Data Tradies</a><br>
      Questions? <a href="mailto:info@datatradies.co.nz">info@datatradies.co.nz</a> · <a href="tel:+6421596641">021 596 641</a>
    </p>
  </div>

</div>

<script>
  const SUPABASE_URL = 'https://oogjcekbnmpijppzuozi.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vZ2pjZWtibm1waWpwcHp1b3ppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNzI2NjksImV4cCI6MjA4Njk0ODY2OX0.S38V9cP4D0aTO2UW7uyUGOFxO77XCp3tSHJfWwxfsgc';
  const HEADERS = { 'apikey': SUPABASE_KEY, 'Authorization': 'Bearer ' + SUPABASE_KEY, 'Content-Type': 'application/json', 'Prefer': 'resolution=merge-duplicates' };

  const STATUSES = ['done', 'progress', 'pending', 'blocked', 'future'];
  const LABELS = { done: 'Done', progress: 'In Progress', pending: 'Pending', blocked: 'Blocked', future: 'Future' };

  function setSyncStatus(state, msg) {
    document.getElementById('syncDot').className = 'dot ' + state;
    document.getElementById('syncText').textContent = msg;
  }

  function applyStatus(el, status) {
    el.className = 'status ' + status;
    el.textContent = LABELS[status];
  }

  // --- Save to Supabase (upsert) ---
  async function saveTask(taskId, fields) {
    setSyncStatus('saving', 'Saving...');
    try {
      const body = { task_id: taskId, updated_at: new Date().toISOString(), ...fields };
      const res = await fetch(SUPABASE_URL + '/rest/v1/task_statuses', {
        method: 'POST', headers: HEADERS, body: JSON.stringify(body)
      });
      if (!res.ok) throw new Error('Save failed');
      setSyncStatus('ok', 'Saved');
    } catch (e) {
      setSyncStatus('err', 'Save failed — try again');
    }
  }

  // --- Load from Supabase ---
  async function loadAll() {
    try {
      const res = await fetch(SUPABASE_URL + '/rest/v1/task_statuses?select=task_id,status,notes', { headers: HEADERS });
      if (!res.ok) throw new Error('Load failed');
      const rows = await res.json();
      const map = {};
      rows.forEach(r => map[r.task_id] = r);

      document.querySelectorAll('[data-task-id]').forEach(el => {
        const row = map[el.dataset.taskId];
        if (row) applyStatus(el, row.status);
      });
      document.querySelectorAll('[data-notes-for]').forEach(el => {
        const row = map[el.dataset.notesFor];
        if (row && row.notes !== undefined) el.textContent = row.notes;
      });
      setSyncStatus('ok', 'Synced — click any status or note to edit');
    } catch (e) {
      setSyncStatus('err', 'Could not load — using defaults');
    }
  }

  // --- Status dropdown on click ---
  document.addEventListener('click', function(e) {
    const badge = e.target.closest('[data-task-id]');
    if (!badge || e.target.tagName === 'SELECT') return;

    // Don't open a second dropdown
    if (badge.querySelector('select')) return;

    const current = STATUSES.find(s => badge.classList.contains(s)) || 'pending';
    const taskId = badge.dataset.taskId;

    const select = document.createElement('select');
    select.className = 'status-select';
    STATUSES.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s;
      opt.textContent = LABELS[s];
      if (s === current) opt.selected = true;
      select.appendChild(opt);
    });

    badge.textContent = '';
    badge.appendChild(select);
    select.focus();

    function commit() {
      const val = select.value;
      applyStatus(badge, val);
      saveTask(taskId, { status: val });
    }
    select.addEventListener('change', commit);
    select.addEventListener('blur', function() {
      // Restore badge if no change
      if (badge.contains(select)) applyStatus(badge, select.value);
    });
  });

  // --- Editable notes on click ---
  document.addEventListener('click', function(e) {
    const cell = e.target.closest('[data-notes-for]');
    if (!cell || cell.querySelector('input')) return;

    const taskId = cell.dataset.notesFor;
    const currentText = cell.textContent;

    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'note-input';
    input.value = currentText;
    cell.textContent = '';
    cell.appendChild(input);
    input.focus();

    function commit() {
      const val = input.value.trim();
      cell.textContent = val;
      if (val !== currentText) saveTask(taskId, { notes: val });
    }
    input.addEventListener('blur', commit);
    input.addEventListener('keydown', function(ev) {
      if (ev.key === 'Enter') { ev.preventDefault(); input.blur(); }
      if (ev.key === 'Escape') { cell.textContent = currentText; }
    });
  });

  loadAll();
</script>
</body>
</html>
